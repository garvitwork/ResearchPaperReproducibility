{
  "abstract": "Machine learning can impact people with legal or ethical consequences when it is used to automate decisions in areas such as insurance, lending, hiring, and predictive policing. In many of these scenarios, previous decisions have been made that are unfairly biased against certain subpopulations, for example those of a particular race, gender, or sexual orientation. Since this past data may be biased, machine learning predictors must account for this to avoid perpetuating or creating discriminatory practices. In this paper, we develop a framework for modeling fairness using tools from causal inference. Our deﬁnition of counterfactual fairness captures the intuition that a decision is fair towards an individual if it is the same in (a) the actual world and (b) a counterfactual world where the individual belonged to a different demographic group. We demonstrate our framework on a real-world problem of fair prediction of success in law school.",
  "introduction": "Machine learning has spread to ﬁelds as diverse as credit scoring [ 20 ], crime prediction [ 5 ], and loan assessment [ 25 ]. Decisions in these areas may have ethical or legal implications, so it is necessary for the modeler to think beyond the objective of maximizing prediction accuracy and consider the societal impact of their work. For many of these applications, it is crucial to ask if the predictions of a model are fair . Training data can contain unfairness for reasons having to do with historical prejudices or other factors outside an individual’s control. In 2016, the Obama administration released a report 2 which urged data scientists to analyze “how technologies can deliberately or inadvertently perpetuate, exacerbate, or mask discrimination.\" There has been much recent interest in designing algorithms that make fair predictions [ 4 , 6 , 10 , 12 , 14 , 16 – 19 , 22 , 24 , 36 – 39 ]. In large part, the literature has focused on formalizing fairness into quantitative deﬁnitions and using them to solve a discrimination problem in a certain dataset. Unfortunately, for a practitioner, law-maker, judge, or anyone else who is interested in implementing algorithms that control for discrimination, it can be difﬁcult to decide which deﬁnition of fairness to choose for the task at hand. Indeed, we demonstrate that depending on the relationship between a protected attribute and the data, certain deﬁnitions of fairness can actually increase discrimination . This work was done while JL was a Research Fellow at the Alan Turing Institute. In this paper, we introduce the ﬁrst explicitly causal approach to address fairness. Speciﬁcally, we leverage the causal framework of Pearl [30] to model the relationship between protected attributes and data. We describe how techniques from causal inference can be effective tools for designing fair algorithms and argue, as in DeDeo [9] , that it is essential to properly address causality in fairness. In perhaps the most closely related prior work, Johnson et al. [15] make similar arguments but from a non-causal perspective. An alternative use of causal modeling in the context of fairness is introduced independently by [21]. In Section 2, we provide a summary of basic concepts in fairness and causal modeling. In Section 3, we provide the formal deﬁnition of counterfactual fairness , which enforces that a distribution over possible predictions for an individual should remain unchanged in a world where an individual’s protected attributes had been different in a causal sense. In Section 4, we describe an algorithm to implement this deﬁnition, while distinguishing it from existing approaches. In Section 5, we illustrate the algorithm with a case of fair assessment of law school success.",
  "related_work": "",
  "background": "This section provides a basic account of two separate areas of research in machine learning, which are formally uniﬁed in this paper. We suggest Berk et al. [1] and Pearl et al. [29] as references. Throughout this paper, we will use the following notation. Let A denote the set of protected attributes of an individual, variables that must not be discriminated against in a formal sense deﬁned differently by each notion of fairness discussed. The decision of whether an attribute is protected or not is taken as a primitive in any given problem, regardless of the deﬁnition of fairness adopted. Moreover, let X denote the other observable attributes of any particular individual, U the set of relevant latent attributes which are not observed, and let Y denote the outcome to be predicted, which itself might be contaminated with historical biases. Finally, ˆ Y is the predictor , a random variable that depends on A, X and U , and which is produced by a machine learning algorithm as a prediction of Y . 2.1 Fairness There has been much recent work on fair algorithms. These include fairness through unawareness [ 12 ], individual fairness [ 10 , 16 , 24 , 38 ], demographic parity/disparate impact [ 36 ], and equality of opportunity [ 14 , 37 ]. For simplicity we often assume A is encoded as a binary attribute, but this can be generalized. Deﬁnition 1 (Fairness Through Unawareness (FTU)) . An algorithm is fair so long as any protected attributes A are not explicitly used in the decision-making process. Any mapping ˆ Y : X → Y that excludes A satisﬁes this. Initially proposed as a baseline, the approach has found favor recently with more general approaches such as Grgic-Hlaca et al. [12] . Despite its compelling simplicity, FTU has a clear shortcoming as elements of X can contain discriminatory information analogous to A that may not be obvious at ﬁrst. The need for expert knowledge in assessing the relationship between A and X was highlighted in the work on individual fairness: Deﬁnition 2 (Individual Fairness (IF)) . An algorithm is fair if it gives similar predictions to similar individuals. Formally, given a metric d ( · , · ) , if individuals i and j are similar under this metric (i.e., d ( i, j ) is small) then their predictions should be similar: ˆ Y ( X ( i ) , A ( i ) ) ≈ ˆ Y ( X ( j ) , A ( j ) ) . As described in [ 10 ], the metric d ( · , · ) must be carefully chosen, requiring an understanding of the domain at hand beyond black-box statistical modeling. This can also be contrasted against population level criteria such as Deﬁnition 3 (Demographic Parity (DP)) . A predictor ˆ Y satisﬁes demographic parity if P ( ˆ Y | A = 0) = P ( ˆ Y | A = 1) . Deﬁnition 4 (Equality of Opportunity (EO)) . A predictor ˆ Y satisﬁes equality of opportunity if P ( ˆ Y = 1 | A = 0 , Y = 1) = P ( ˆ Y = 1 | A = 1 , Y = 1) . These criteria can be incompatible in general, as discussed in [ 1 , 7 , 22 ]. Following the motivation of IF and [ 15 ], we propose that knowledge about relationships between all attributes should be taken into consideration, even if strong assumptions are necessary. Moreover, it is not immediately clear 2 for any of these approaches in which ways historical biases can be tackled. We approach such issues from an explicit causal modeling perspective. 2.2 Causal Models and Counterfactuals We follow Pearl [28], and deﬁne a causal model as a triple ( U, V, F ) of sets such that • U is a set of latent background variables,which are factors not caused by any variable in the set V of observable variables; • F is a set of functions { f 1 , . . . , f n } , one for each V i ∈ V , such that V i = f i ( pa i , U pa i ) , pa i ⊆ V \\{ V i } and U pa i ⊆ U . Such equations are also known as structural equations [ 2 ]. The notation “ pa i ” refers to the “parents” of V i and is motivated by the assumption that the model factorizes as a directed graph, here assumed to be a directed acyclic graph (DAG). The model is causal in that, given a distribution P ( U ) over the background variables U , we can derive the distribution of a subset Z ⊆ V following an intervention on V \\ Z . An intervention on variable V i is the substitution of equation V i = f i ( pa i , U pa i ) with the equation V i = v for some v . This captures the idea of an agent, external to the system, modifying it by forcefully assigning value v to V i , for example as in a randomized experiment. The speciﬁcation of F is a strong assumption but allows for the calculation of counterfactual quantities. In brief, consider the following counterfactual statement, “the value of Y if Z had taken value z ”, for two observable variables Z and Y . By assumption, the state of any observable variable is fully determined by the background variables and structural equations. The counterfactual is modeled as the solution for Y for a given U = u where the equations for Z are replaced with Z = z . We denote it by Y Z ← z ( u ) [28], and sometimes as Y z if the context of the notation is clear. Counterfactual inference, as speciﬁed by a causal model ( U, V, F ) given evidence W , is the computa- tion of probabilities P ( Y Z ← z ( U ) | W = w ) , where W , Z and Y are subsets of V . Inference proceeds in three steps, as explained in more detail in Chapter 4 of Pearl et al. [29] : 1. Abduction : for a given prior on U , compute the posterior distribution of U given the evidence W = w ; 2. Action : substitute the equations for Z with the interventional values z , resulting in the modiﬁed set of equations F z ; 3. Prediction : compute the implied distribution on the remaining elements of",
  "methodology": "Given a predictive problem with fairness considerations, where A , X and Y represent the protected attributes, remaining attributes, and output of interest respectively, let us assume that we are given a causal model ( U, V, F ) , where V ≡ A ∪ X . We postulate the following criterion for predictors of Y . Deﬁnition 5 (Counterfactual fairness) . Predictor ˆ Y is counterfactually fair if under any context X = x and A = a , P ( ˆ Y A ← a ( U ) = y | X = x, A = a ) = P ( ˆ Y A ← a ′ ( U ) = y | X = x, A = a ) , (1) for all y and for any value a ′ attainable by A . This notion is closely related to actual causes [ 13 ], or token causality in the sense that, to be fair, A should not be a cause of ˆ Y in any individual instance. In other words, changing A while holding things which are not causally dependent on A constant will not change the distribution of ˆ Y . We also emphasize that counterfactual fairness is an individual-level deﬁnition. This is substantially different from comparing different individuals that happen to share the same “treatment” A = a and coincide on the values of X , as discussed in Section 4.3.1 of [ 29 ] and the Supplementary Material. Differences between X a and X a ′ must be caused by variations on A only. Notice also that this deﬁnition is agnostic with respect to how good a predictor ˆ Y is, which we discuss in Section 4. Relation to individual fairness . IF is agnostic with respect to its notion of similarity metric, which is both a strength (generality) and a weakness (no uniﬁed way of deﬁning similarity). Counterfactuals and similarities are related, as in the classical notion of distances between “worlds” corresponding to different counterfactuals [ 23 ]. If ˆ Y is a deterministic function of W ⊂ A ∪ X ∪ U , as in several of for discussion. (c) The graph corresponding to a causal model with A being the protected attribute and Y some outcome of interest, with background variables assumed to be independent. (d) Expanding the model to include an intermediate variable indicating whether the individual is employed with two (latent) background variables Prejudiced (if the person offering the job is prejudiced) and Qualiﬁcations (a measure of the individual’s qualiﬁcations). (e) A twin network representation of this system [ 28 ] under two different counterfactual levels for A . This is created by copying nodes descending from A , which inherit unaffected parents from the factual world. our examples to follow, then IF can be deﬁned by treating equally two individuals with the same W in a way that is also counterfactually fair. Relation to Pearl et al. [29] . In Example 4.4.4 of [ 29 ], the authors condition instead on X , A , and the observed realization of ˆ Y , and calculate the probability of the counterfactual realization ˆ Y A ← a ′ differing from the factual. This example conﬂates the predictor ˆ Y with the outcome Y , of which we remain agnostic in our deﬁnition but which is used in the construction of ˆ Y as in Section 4. Our framing makes the connection to machine learning more explicit. 3.1 Examples To provide an intuition for counterfactual fairness, we will consider two real-world fair prediction sce- narios: insurance pricing and crime prediction . Each of these correspond to one of the two causal graphs in Figure 1(a),(b). The Supplementary Material provides a more mathematical discussion of these examples with more detailed insights. Scenario 1: The Red Car. A car insurance company wishes to price insurance for car owners by predicting their accident rate Y . They assume there is an unobserved factor corresponding to aggressive driving U , that (a) causes drivers to be more likely have an accident, and (b) causes individuals to prefer red cars (the observed variable X ). Moreover, individuals belonging to a certain race A are more likely to drive red cars. However, these individuals are no more likely to be aggressive or to get in accidents than any one else. We show this in Figure 1(a). Thus, using the red car feature X to predict accident rate Y would seem to be an unfair prediction because it may charge individuals of a certain race more than others, even though no race is more likely to have an accident. Counterfactual fairness agrees with this notion: changing A while holding U ﬁxed will also change X and, consequently, ˆ Y . Interestingly, we can show (Supplementary Material) that in a linear model, regressing Y on A and X is equivalent to regressing on U , so off-the-shelf regression here is counterfactually fair. Regressing Y on X alone obeys the FTU criterion but is not counterfactually fair, so omitting A (FTU) may introduce unfairness into an otherwise fair world. Scenario 2: High Crime Regions. A city government wants to estimate crime rates by neighbor- hood to allocate policing resources. Its analyst constructed training data by merging (1) a registry of residents containing their neighborhood X and race A , with (2) police records of arrests, giving each resident a binary label with Y = 1 indicating a criminal arrest record. Due to historically segregated housing, the location X depends on A . Locations X with more police resources have larger numbers of arrests Y . And ﬁnally, U represents the totality of socioeconomic factors and policing practices that both inﬂuence where an individual may live and how likely they are to be arrested and charged. This can all be seen in Figure 1(b). In this example, higher observed arrest rates in some neighborhoods are due to greater policing there, not because people of different races are any more or less likely to break the law. The label Y = 0 4 does not mean someone has never committed a crime, but rather that they have not been caught. If individuals in the training data have not already had equal opportunity, algorithms enforcing EO will not remedy such unfairness . In contrast, a counterfactually fair approach would model differential enforcement rates using U and base predictions on this information rather than on X directly. In general, we need a multistage procedure in which we ﬁrst derive latent variables U , and then based on them we minimize some loss with respect to Y . This is the core of the algorithm discussed next. 3.2 Implications One simple but important implication of the deﬁnition of counterfactual fairness is the following: Lemma 1. Let G be the causal graph of the given model ( U, V, F ) . Then ˆ Y will be counterfactually fair if it is a function of the non-descendants of A . Proof. Let W be any non-descendant of A in G . Then W A ← a ( U ) and W A ← a ′ ( U ) have the same distribution by the three inferential steps in Section 2.2. Hence, the distribution of any function ˆ Y of the non-descendants of A is invariant with respect to the counterfactual values of A . This does not exclude using a descendant W of A as a possible input to ˆ Y . However, this will only be possible in the case where the overall dependence of ˆ Y on A disappears, which will not happen in general. Hence, Lemma 1 provides the most straightforward way to achieve counterfactual fairness. In some scenarios, it is desirable to deﬁne path-speciﬁc variations of counterfactual fairness that allow for the inclusion of some descendants of A , as discussed by [ 21 , 27 ] and the Supplementary Material. Ancestral closure of protected attributes. Suppose that a parent of a member of A is not in A . Counterfactual fairness allows for the use of it in the deﬁnition of ˆ Y . If this seems counterintuitive, then we argue that the fault should be at the postulated set of protected attributes rather than with the deﬁnition of counterfactual fairness, and that typically we should expect set A to be closed under ancestral relationships given by the causal graph. For instance, if Race is a protected attribute, and Mother’s race is a parent of Race , then it should also be in A . Dealing with historical biases and an existing fairness paradox. The explicit difference between ˆ Y and Y allows us to tackle historical biases. For instance, let Y be an indicator of whether a client defaults on a loan, while ˆ Y is the actual decision of giving the loan. Consider the DAG A → Y , shown in Figure 1(c) with the explicit inclusion of set U of independent background variables. Y is the objectively ideal measure for decision making, the binary indicator of the event that the individual defaults on a loan. If A is postulated to be a protected attribute, then the predictor ˆ Y = Y = f Y ( A, U ) is not counterfactually fair, with the arrow A → Y being (for instance) the result of a world that punishes individuals in a way that is out of their control. Figure 1(d) shows a ﬁner-grained model, where the path is mediated by a measure of whether the person is employed, which is itself caused by two background factors: one representing whether the person hiring is prejudiced, and the other the employee’s qualiﬁcations. In this world, A is a cause of defaulting, even if mediated by other variables 3 . The counterfactual fairness principle however forbids us from using Y : using the twin network 4 of Pearl [28] , we see in Figure 1(e) that Y a and Y a ′ need not be identically distributed given the background variables. In contrast, any function of variables not descendants of A can be used a basis for fair decision making. This means that any variable ˆ Y deﬁned by ˆ Y = g ( U ) will be counterfactually fair for any function g ( · ) . Hence, given a causal model, the functional deﬁned by the function g ( · ) minimizing some predictive error for Y will satisfy the criterion, as proposed in Section 4.1. We are essentially learning a projection of Y into the space of fair decisions, removing historical biases as a by-product. Counterfactual fairness also provides an answer to some problems on the incompatibility of fairness criteria. In particular, consider the following problem raised independently by different authors (e.g., 3 For example, if the function determining employment f E ( A, P, Q ) ≡ I ( Q> 0 ,P =0 or A ̸ = a ) then an individual with sufﬁcient qualiﬁcations and prejudiced potential employer may have a different counterfactual employment value for A = a compared to A = a ′ , and a different chance of default. 4 In a nutshell, this is a graph that simultaneously depicts “multiple worlds” parallel to the factual realizations. In this graph, all multiple worlds share the same background variables, but with different consequences in the remaining variables depending on which counterfactual assignments are provided. 5 [ 7 , 22 ]), illustrated below for the binary case: ideally, we would like our predictors to obey both Equality of Opportunity and the predictive parity criterion deﬁned by satisfying P ( Y = 1 | ˆ Y = 1 , A = 1) = P ( Y = 1 | ˆ Y = 1 , A = 0) , as well as the corresponding equation for ˆ Y = 0 . It has been shown that if Y and A are marginally associated (e.g., recidivism and race are associated) and Y is not a deterministic function of ˆ Y , then the two criteria cannot be reconciled. Counterfactual fairness throws a light in this scenario, suggesting that both EO and predictive parity may be insufﬁcient if Y and A are associated: assuming that A and Y are unconfounded (as expected for demographic attributes), this is the result of A being a cause of Y . By counterfactual fairness, we should not want to use Y as a basis for our decisions, instead aiming at some function Y ⊥ A of variables which are not caused by A but are predictive of Y . ˆ Y is deﬁned in such a way that is an estimate of the “closest” Y ⊥ A to Y according to some preferred risk function. This makes the incompatibility between EO and predictive parity irrelevant , as A and Y ⊥ A will be independent by construction given the model assumptions.\n\nAs discussed in the previous Section, we need to relate ˆ Y to Y if the predictor is to be useful, and we restrict ˆ Y to be a (parameterized) function of the non-descendants of A in the causal graph following Lemma 1. We next introduce an algorithm, then discuss assumptions that can be used to express counterfactuals. 4.1 Algorithm Let ˆ Y ≡ g θ ( U, X ⊁ A ) be a predictor parameterized by θ , such as a logistic regression or a neural network, and where X ⊁ A ⊆ X are non-descendants of A . Given a loss function l ( · , · ) such as squared loss or log-likelihood, and training data D ≡{ ( A ( i ) , X ( i ) , Y ( i ) ) } for i = 1 , 2 , . . . , n , we deﬁne L ( θ ) ≡ P n i =1 E [ l ( y ( i ) , g θ ( U ( i ) , x ( i ) ⊁ A )) | x ( i ) , a ( i ) ] /n as the empirical loss to be minimized with respect to θ . Each expectation is with respect to random variable U ( i ) ∼ P M ( U | x ( i ) , a ( i ) ) where P M ( U | x, a ) is the conditional distribution of the background variables as given by a causal model M that is available by assumption. If this expectation cannot be calculated analytically, Markov chain Monte Carlo (MCMC) can be used to approximate it as in the following algorithm. 1: procedure F AIR L EARNING ( D , M ) ▷ Learned parameters ˆ θ 2: For each data point i ∈D , sample m MCMC samples U ( i ) 1 , . . . , U ( i ) m ∼ P M ( U | x ( i ) , a ( i ) ) . 3: Let D ′ be the augmented dataset where each point ( a ( i ) , x ( i ) , y ( i ) ) in D is replaced with the corresponding m points { ( a ( i ) , x ( i ) , y ( i ) , u ( i ) j ) } . 4: ˆ θ ← argmin θ P i ′ ∈D ′ l ( y ( i ′ ) , g θ ( U ( i ′ ) , x ( i ′ ) ⊁ A )) . 5: end procedure At prediction time, we report ˜ Y ≡ E [ ˆ Y ( U ⋆ , x ⋆ ⊁ A ) | x ⋆ , a ⋆ ] for a new data point ( a ⋆ , x ⋆ ) . Deconvolution perspective. The algorithm can be understood as a deconvolution approach that, given observables A ∪ X , extracts its latent sources and pipelines them into a predictive model. We advocate that counterfactual assumptions must underlie all approaches that claim to extract the sources of variation of the data as “fair” latent components . As an example, Louizos et al. [24] start from the DAG A → X ← U to extract P ( U | X, A ) . As U and A are not independent given X in this representation, a type of penalization is enforced to create a posterior P fair ( U | A, X ) that is close to the model posterior P ( U | A, X ) while satisfying P fair ( U | A = a, X ) ≈ P fair ( U | A = a ′ , X ) . But this is neither necessary nor sufﬁcient for counterfactual fairness . The model for X given A and U must be justiﬁed by a causal mechanism, and that being the case, P ( U | A, X ) requires no postprocessing. As a matter of fact, model M can be learned by penalizing empirical dependence measures between U and pa i for a given V i (e.g. Mooij et al. [26] ), but this concerns M and not ˆ Y , and is motivated by explicit assumptions about structural equations, as described next. 6 4.2 Designing the Input Causal Model Model M must be provided to algorithm F AIR L EARNING . Although this is well understood, it is worthwhile remembering that causal models always require strong assumptions, even more so when making counterfactual claims [ 8 ]. Counterfactuals assumptions such as structural equations are in general unfalsiﬁable even if interventional data for all variables is available. This is because there are inﬁnitely many structural equations compatible with the same observable distribution [ 28 ], be it observational or interventional. Having passed testable implications, the remaining components of a counterfactual model should be understood as conjectures formulated according to the best of our knowledge. Such models should be deemed provisional and prone to modiﬁcations if, for example, new data containing measurement of variables previously hidden contradict the current model. We point out that we do not need to specify a fully deterministic model, and structural equations can be relaxed as conditional distributions. In particular, the concept of counterfactual fairness holds under three levels of assumptions of increasing strength: Level 1. Build ˆ Y using only the observable non-descendants of A . This only requires partial causal ordering and no further causal assumptions, but in many problems there will be few, if any, observables which are not descendants of protected demographic factors. Level 2. Postulate background latent variables that act as non-deterministic causes of observable variables, based on explicit domain knowledge and learning algorithms 5 . Information about X is passed to ˆ Y via P ( U | x, a ) . Level 3. Postulate a fully deterministic model with latent variables. For instance, the distribution P ( V i | pa i ) can be treated as an additive error model, V i = f i ( pa i )+ e i [ 31 ]. The error term e i then becomes an input to ˆ Y as calculated from the observed variables. This maximizes the information extracted by the fair predictor ˆ Y . 4.3 Further Considerations on Designing the Input Causal Model One might ask what we can lose by deﬁning causal fairness measures involving only non- counterfactual causal quantities, such as enforcing P ( ˆ Y = 1 | do ( A = a )) = P ( ˆ Y = 1 | do ( A = a ′ )) instead of our counterfactual criterion. The reason is that the above equation is only a constraint on an average effect. Obeying this criterion provides no guarantees against, for example, having half of the individuals being strongly “negatively” discriminated and half of the individuals strongly “positively” discriminated. We advocate that, for fairness, society should not be satisﬁed in pursuing only counterfactually-free guarantees. While one may be willing to claim posthoc that the equation above masks no balancing effect so that individuals receive approximately the same distribution of outcomes, that itself is just a counterfactual claim in disguise. Our approach is to make counterfactual assumptions explicit. When unfairness is judged to follow only some “pathways” in the causal graph (in a sense that can be made formal, see [ 21 , 27 ]), nonparametric assumptions about the independence of counterfactuals may sufﬁce, as discussed by [ 27 ]. In general, nonparametric assumptions may not provide identiﬁable adjustments even in this case, as also discussed in our Supplementary Material. If competing models with different untestable assumptions are available, there are ways of simultane- ously enforcing a notion of approximate counterfactual fairness in all of them, as introduced by us in [32]. Other alternatives include exploiting bounds on the contribution of hidden variables [29, 33]. Another issue is the interpretation of causal claims involving demographic variables such as race and sex. Our view is that such constructs are the result of translating complex events into random variables and, despite some controversy, we consider counterproductive to claim that e.g. race and sex cannot be causes. An idealized intervention on some A at a particular time can be seen as a notational shortcut to express a conjunction of more speciﬁc interventions, which may be individually doable but jointly impossible in practice. It is the plausibility of complex, even if impossible to practically manipulate, causal chains from A to Y that allows us to claim that unfairness is real [ 11 ]. Experiments for constructs exist, such as randomizing names in job applications to make them race-blind. They do not contradict the notion of race as a cause, and can be interpreted as an intervention on a particular aspect of the construct “race,” such as “race perception” (e.g. Section 4.4.4 of [29]). 5 In some domains, it is actually common to build a model entirely around latent constructs with few or no observable parents nor connections among observed variables [2].",
  "datasets": "",
  "experiments": "We illustrate our approach on a practical problem that requires fairness, the prediction of success in law school . A second problem, understanding the contribution of race to police stops , is described in the Supplementary Material. Following closely the usual framework for assessing causal models in the machine learning literature, the goal of this experiment is to quantify how our algorithm behaves with ﬁnite sample sizes while assuming ground truth compatible with a synthetic model. Problem deﬁnition: Law school success The Law School Admission Council conducted a survey across 163 law schools in the United States [ 35 ]. It contains information on 21,790 law students such as their entrance exam scores (LSAT), their grade-point average (GPA) collected prior to law school, and their ﬁrst year average grade (FYA). Given this data, a school may wish to predict if an applicant will have a high FYA. The school would also like to make sure these predictions are not biased by an individual’s race and sex. However, the LSAT, GPA, and FYA scores, may be biased due to social factors. We compare our framework with two unfair baselines: 1. Full : the standard technique of using all features, including sensitive features such as race and sex to make predictions; 2. Unaware : fairness through unawareness, where we do not use race and sex as features. For comparison, we generate predictors ˆ Y for all models using logistic regression. Fair prediction. As described in Section 4.2, there are three ways in which we can model a counterfactually fair predictor of FYA. Level 1 uses any features which are not descendants of race and sex for prediction. Level 2 models latent ‘fair’ variables which are parents of observed variables. These variables are independent of both race and sex. Level 3 models the data using an additive error model, and uses the independent error terms to make predictions. These models make increasingly strong assumptions corresponding to increased predictive power. We split the dataset 80/20 into a train/test set, preserving label balance, to evaluate the models. As we believe LSAT, GPA, and FYA are all biased by race and sex, we cannot use any observed features to construct a counterfactually fair predictor as described in Level 1. In Level 2, we postulate that a latent variable: a student’s knowledge (K), affects GPA, LSAT, and FYA scores. The causal graph corresponding to this model is shown in Figure 2, ( Level 2 ). This is a short-hand for the distributions: GPA ∼N ( b G + w K G K + w R G R + w S G S, σ G ) , FYA ∼N ( w K F K + w R F R + w S F S, 1) , LSAT ∼ Poisson (exp( b L + w K L K + w R L R + w S L S )) , K ∼N (0 , 1) We perform inference on this model using an observed training set to estimate the posterior distribution of K . We use the probabilistic programming language Stan [ 34 ] to learn K . We call the predictor",
  "results": "",
  "discussion": "",
  "conclusion": "We have presented a new model of fairness we refer to as counterfactual fairness . It allows us to propose algorithms that, rather than simply ignoring protected attributes, are able to take into account the different social biases that may arise towards individuals based on ethically sensitive attributes and compensate for these biases effectively. We experimentally contrasted our approach with previous fairness approaches and show that our explicit causal models capture these social biases and make clear the implicit trade-off between prediction accuracy and fairness in an unfair world. We propose that fairness should be regulated by explicitly modeling the causal structure of the world. Criteria based purely on probabilistic independence cannot satisfy this and are unable to address how unfairness is occurring in the task at hand. By providing such causal tools for addressing fairness questions we hope we can provide practitioners with customized techniques for solving a wide array of fairness modeling problems. 9 Acknowledgments This work was supported by the Alan Turing Institute under the EPSRC grant EP/N510129/1. CR acknowledges additional support under the EPSRC Platform Grant EP/P022529/1. We thank Adrian Weller for insightful feedback, and the anonymous reviewers for helpful comments.",
  "other": {
    "counter-": "A causal model for the problem of predicting law school success fairly. Right: Density plots of predicted FYA a and FYA a ′ . In Level 3, we model GPA, LSAT, and FYA as continuous variables with additive error terms independent of race and sex (that may in turn be correlated with one-another). This model is shown 8 Table 1: Prediction results using logistic regression. Note that we must sacriﬁce a small amount of accuracy to ensuring counterfactually fair prediction (Fair K , Fair Add), versus the models that use unfair features: GPA, LSAT, race, sex (Full, Unaware). Full Unaware Fair K Fair Add RMSE 0.873 0.894 0.929 0.918 in Figure 2, ( Level 3 ), and is expressed by: GPA = b G + w R G R + w S G S + ϵ G , ϵ G ∼ p ( ϵ G ) LSAT = b L + w R L R + w S L S + ϵ L , ϵ L ∼ p ( ϵ L ) FYA = b F + w R F R + w S F S + ϵ F , ϵ F ∼ p ( ϵ F ) We estimate the error terms ϵ G , ϵ L by ﬁrst ﬁtting two models that each use race and sex to individually predict GPA and LSAT. We then compute the residuals of each model (e.g., ϵ G = GPA − ˆ Y GPA ( R, S ) ). We use these residual estimates of ϵ G , ϵ L to predict FYA. We call this Fair Add . Accuracy. We compare the RMSE achieved by logistic regression for each of the models on the test set in Table 1. The Full model achieves the lowest RMSE as it uses race and sex to more accurately reconstruct FYA. Note that in this case, this model is not fair even if the data was generated by one of the models shown in Figure 2 as it corresponds to Scenario 3. The (also unfair) Unaware model still uses the unfair variables GPA and LSAT, but because it does not use race and sex it cannot match the RMSE of the Full model. As our models satisfy counterfactual fairness, they trade off some accuracy. Our ﬁrst model Fair K uses weaker assumptions and thus the RMSE is highest. Using the Level 3 assumptions, as in Fair Add we produce a counterfactually fair model that trades slightly stronger assumptions for lower RMSE. Counterfactual fairness. We would like to empirically test whether the baseline methods are counterfactually fair. To do so we will assume the true model of the world is given by Figure 2, ( Level 2 ). We can ﬁt the parameters of this model using the observed data and evaluate counterfactual fairness by sampling from it. Speciﬁcally, we will generate samples from the model given either the observed race and sex, or counterfactual race and sex variables. We will ﬁt models to both the original and counterfactual sampled data and plot how the distribution of predicted FYA changes for both baseline models. Figure 2 shows this, where each row corresponds to a baseline predictor and each column corresponds to the counterfactual change. In each plot, the blue distribution is density of predicted FYA for the original data and the red distribution is this density for the counterfactual data. If a model is counterfactually fair we would expect these distributions to lie exactly on top of each other. Instead, we note that the Full model exhibits counterfactual unfairness for all counterfactuals except sex. We see a similar trend for the Unaware model, although it is closer to being counterfactually fair. To see why these models seem to be fair w.r.t. to sex we can look at weights of the DAG which generates the counterfactual data. Speciﬁcally the DAG weights from (male,female) to GPA are ( 0 . 93 , 1 . 06 ) and from (male,female) to LSAT are ( 1 . 1 , 1 . 1 ). Thus, these models are fair w.r.t. to sex simply because of a very weak causal link between sex and GPA/LSAT.",
    "references": "[1] Berk, R., Heidari, H., Jabbari, S., Kearns, M., and Roth, A. Fairness in criminal justice risk assessments: The state of the art. arXiv:1703.09207v1 , 2017. [2] Bollen, K. Structural Equations with Latent Variables . John Wiley & Sons, 1989. [3] Bollen, K. and (eds.), J. Long. Testing Structural Equation Models . SAGE Publications, 1993. [4] Bolukbasi, Tolga, Chang, Kai-Wei, Zou, James Y, Saligrama, Venkatesh, and Kalai, Adam T. Man is to computer programmer as woman is to homemaker? debiasing word embeddings. In Advances in Neural Information Processing Systems , pp. 4349–4357, 2016. [5] Brennan, Tim, Dieterich, William, and Ehret, Beate. Evaluating the predictive validity of the compas risk and needs assessment system. Criminal Justice and Behavior , 36(1):21–40, 2009. [6] Calders, Toon and Verwer, Sicco. Three naive bayes approaches for discrimination-free classiﬁ- cation. Data Mining and Knowledge Discovery , 21(2):277–292, 2010. [7] Chouldechova, A. Fair prediction with disparate impact: a study of bias in recidivism prediction instruments. Big Data , 2:153–163, 2017. [8] Dawid, A. P. Causal inference without counterfactuals. Journal of the American Statistical Association , pp. 407–448, 2000. [9] DeDeo, Simon. Wrong side of the tracks: Big data and protected categories. arXiv preprint arXiv:1412.4643 , 2014. [10] Dwork, Cynthia, Hardt, Moritz, Pitassi, Toniann, Reingold, Omer, and Zemel, Richard. Fairness through awareness. ACM, 2012. [11] Glymour, C. and Glymour, M. R. Commentary: Race and sex are causes. Epidemiology , 25(4): 488–490, 2014. [12] Grgic-Hlaca, Nina, Zafar, Muhammad Bilal, Gummadi, Krishna P, and Weller, Adrian. The case for process fairness in learning: Feature selection for fair decision making. NIPS Symposium on Machine Learning and the Law , 2016. [13] Halpern, J. Actual Causality . MIT Press, 2016. [14] Hardt, Moritz, Price, Eric, Srebro, Nati, et al. Equality of opportunity in supervised learning. In Advances in Neural Information Processing Systems , pp. 3315–3323, 2016. [15] Johnson, Kory D, Foster, Dean P, and Stine, Robert A. Impartial predictive modeling: Ensuring fairness in arbitrary models. arXiv preprint arXiv:1608.00528 , 2016. [16] Joseph, Matthew, Kearns, Michael, Morgenstern, Jamie, Neel, Seth, and Roth, Aaron. Rawlsian fairness for machine learning. arXiv preprint arXiv:1610.09559 , 2016. [17] Kamiran, Faisal and Calders, Toon. Classifying without discriminating. In Computer, Control and Communication, 2009. IC4 2009. 1–6. IEEE, 2009. [18] Kamiran, Faisal and Calders, Toon. Data preprocessing techniques for classiﬁcation without discrimination. Knowledge and Information Systems , 33(1):1–33, 2012. [19] Kamishima, Toshihiro, Akaho, Shotaro, and Sakuma, Jun. Fairness-aware learning through regularization approach. IEEE, 2011. 10 [20] Khandani, Amir E, Kim, Adlar J, and Lo, Andrew W. Consumer credit-risk models via machine-learning algorithms. Journal of Banking & Finance , 34(11):2767–2787, 2010. [21] Kilbertus, N., Carulla, M. R., Parascandolo, G., Hardt, M., Janzing, D., and Schölkopf, B. Avoiding discrimination through causal reasoning. Advances in Neural Information Processing Systems 30 , 2017. [22] Kleinberg, J., Mullainathan, S., and Raghavan, M. Inherent trade-offs in the fair determination of risk scores. Proceedings of The [23] Lewis, D. Counterfactuals . Harvard University Press, 1973. [24] Louizos, Christos, Swersky, Kevin, Li, Yujia, Welling, Max, and Zemel, Richard. The variational fair autoencoder. arXiv preprint arXiv:1511.00830 , 2015. [25] Mahoney, John F and Mohen, James M. Method and system for loan origination and underwrit- ing, October 23 2007. US Patent 7,287,008. [26] Mooij, J., Janzing, D., Peters, J., and Scholkopf, B. Regression by dependence minimization and its application to causal inference in additive noise models. [27] Nabi, R. and Shpitser, I. Fair inference on outcomes. arXiv:1705.10378v1 , 2017. [28] Pearl, J. Causality: Models, Reasoning and Inference . Cambridge University Press, 2000. [29] Pearl, J., Glymour, M., and Jewell, N. Causal Inference in Statistics: a Primer . Wiley, 2016. [30] Pearl, Judea. Causal inference in statistics: An overview. Statistics Surveys , 3:96–146, 2009. [31] Peters, J., Mooij, J. M., Janzing, D., and Schölkopf, B. Causal discovery with continuous additive noise models. Journal of Machine Learning Research , 15:2009–2053, 2014. URL http://jmlr.org/papers/v15/peters14a.html . [32] Russell, C., Kusner, M., Loftus, J., and Silva, R. When worlds collide: integrating different counterfactual assumptions in fairness. Advances in Neural Information Processing Systems , 31, 2017. [33] Silva, R. and Evans, R. Causal inference through a witness protection program. Journal of Machine Learning Research , 17(56):1–53, 2016. [34] Stan Development Team. Rstan: the r interface to stan, 2016. R package version 2.14.1. [35] Wightman, Linda F. Lsac national longitudinal bar passage study. lsac research report series. 1998. [36] Zafar, Muhammad Bilal, Valera, Isabel, Rodriguez, Manuel Gomez, and Gummadi, Krishna P. Learning fair classiﬁers. arXiv preprint arXiv:1507.05259 , 2015. [37] Zafar, Muhammad Bilal, Valera, Isabel, Rodriguez, Manuel Gomez, and Gummadi, Krishna P. Fairness beyond disparate treatment & disparate impact: Learning classiﬁcation without dis- parate mistreatment. arXiv preprint arXiv:1610.08452 , 2016. [38] Zemel, Richard S, Wu, Yu, Swersky, Kevin, Pitassi, Toniann, and Dwork, Cynthia. Learning fair representations. ICML (3) , 28:325–333, 2013. [39] Zliobaite, Indre. A survey on measuring indirect discrimination in machine learning.",
    "s1 population level vs individual level causal eff": "As discussed in Section 3, counterfactual fairness is an individual-level deﬁnition. This is funda- mentally different from comparing different units that happen to share the same “treatment” A = a and coincide on the values of X . To see in detail what this means, consider the following thought experiment. Let us assess the causal effect of A on ˆ Y by controlling A at two levels, a and a ′ . In Pearl’s notation, where “ do ( A = a ) ” expresses an intervention on A at level a , we have that E [ ˆ Y | do ( A = a ) , X = x ] − E [ ˆ Y | do ( A = a ′ ) , X = x ] , (2) is a measure of causal effect, sometimes called the average causal effect (ACE). It expresses the change that is expected when we intervene on A while observing the attribute set X = x , under two levels of treatment. If this effect is non-zero, A is considered to be a cause of ˆ Y . This raises a subtlety that needs to be addressed: in general, this effect will be non-zero even if ˆ Y is counterfactually fair . This may sound counter-intuitive: protected attributes such as race and gender are causes of our counterfactually fair decisions. In fact, this is not a contradiction, as the ACE in Equation (2) is different from counterfactual effects. The ACE contrasts two independent exchangeable units of the population, and it is a perfectly valid way of performing decision analysis. However, the value of X = x is affected by different background variables corresponding to different individuals. That is, the causal effect (2) contrasts two units that receive different treatments but which happen to coincide on X = x . To give a synthetic example, imagine the simple structural equation X = A + U. The ACE quantiﬁes what happens among people with U = x − a against people with U ′ = x − a ′ . If, for instance, ˆ Y = λU for λ ̸ = 0 , then the effect (2) is λ ( a − a ′ ) ̸ = 0 . Contrary to that, the counterfactual difference is zero. That is, E [ ˆ Y A ← a ( U ) | A = a, X = x ] − E [ ˆ Y A ← a ′ ( U ) | A = a, X = x ] = λU − λU = 0 . In another perspective, we can interpret the above just as if we had measured U from the beginning rather than performing abduction. We then generate ˆ Y from some g ( U ) , so U is the within-unit cause of ˆ Y and not A . If U cannot be deterministically derived from { A = a, X = x } , the reasoning is similar. By abduction, the distribution of U will typically depend on A , and hence so will ˆ Y when marginalizing over U . Again, this seems to disagree with the intuition that our predictor should be not be caused by A . However, this once again is a comparison across individuals , not within an individual. It is this balance among ( A, X, U ) that explains, in the examples of Section 3.1, why some predictors are counterfactually fair even though they are functions of the same variables { A, X } used by unfair predictors: such functions must correspond to particular ways of balancing the observables that, by way of the causal assumptions, cancel out the effect of A . More on conditioning and alternative deﬁnitions. As discussed in Example 4.4.4 of Pearl et al. [29], a different proposal for assessing fairness can be deﬁned via the following concept: Deﬁnition 6 (Probability of sufﬁciency) . We deﬁne the probability of event { A = a } being a sufﬁcient cause for our decision ˆ Y , contrasted against { A = a ′ } , as P ( ˆ Y A ← a ′ ( U ) ̸ = y | X = x, A = a, ˆ Y = y ) . (3) We can then, for instance, claim that ˆ Y is a fair predictor if this probability is below some pre-speciﬁed bound for all ( x, a, a ′ ) . The shortcomings of this deﬁnition come from its original motivation: to explain the behavior of an existing decision protocol, where ˆ Y is the current practice and which in a unclear way is conﬂated with Y . The implication is that if ˆ Y is to be designed instead of being a natural measure of existing behaviour, then we are using ˆ Y itself as evidence for the background 12 variables U . This does not make sense if ˆ Y is yet to be designed by us. If ˆ Y is to be interpreted as Y , then this does not provide a clear recipe on how to build ˆ Y : while we can use Y to learn a causal model, we cannot use it to collect training data evidence for U as the outcome Y will not be available to us at prediction time . For this reason, we claim that while probability of sufﬁciency is useful as a way of assessing an existing decision making process, it is not as natural as counterfactual fairness in the context of machine learning. Approximate fairness and model validation. The notion of probability of sufﬁciency raises the question on how to deﬁne approximate, or high probability, counterfactual fairness. This is an important question that we address in [ 32 ]. Before deﬁning an approximation, it is important to ﬁrst expose in detail what the exact deﬁnition is, which is the goal of this paper. We also do not address the validation of the causal assumptions used by the input causal model of the F AIR L EARNING algorithm in Section 4.1. The reason is straightforward: this validation is an entirely self-contained step of the implementation of counterfactual fairness. An extensive literature already exists in this topic which the practitioner can refer to (a classic account for instance is [ 3 ]), and which can be used as-is in our context. The experiments performed in Section 5 can be criticized by the fact that they rely on a model that obeys our assumptions, and “obviously” our approach should work better than alternatives. This criticism is not warranted: in machine learning, causal inference is typically assessed through simulations which assume that the true model lies in the family covered by the algorithm. Algorithms, including F AIR L EARNING , are justiﬁed in the population sense. How different competitors behave with ﬁnite sample sizes is the primary question to be studied in an empirical study of a new concept, where we control for the correctness of the assumptions. Although sensitivity analysis is important, there are many degrees of freedom on how this can be done. Robustness issues are better addressed by extensions focusing on approximate versions of counterfactual fairness. This will be covered in later work. Stricter version. For completeness of exposition, notice that the deﬁnition of counterfactual fairness could be strengthened to P ( ˆ Y A ← a ( U ) = ˆ Y A ← a ′ ( U ) | X = x, A = a ) = 1 . (4) This is different from the original deﬁnition in the case where ˆ Y ( U ) is a random variable with a different source of randomness for different counterfactuals (for instance, if ˆ Y is given by some black-box function of U with added noise that is independent across each countefactual value of A ). In such a situation, the event { ˆ Y A ← a ( U ) = ˆ Y A ← a ′ ( U ) } will itself have probability zero even if P ( ˆ Y A ← a ( U ) = y | X = x, A = a ) = P ( ˆ Y A ← a ′ ( U ) = y | X = x, A = a ) for all y . We do not consider version (4) as in our view it does not feel as elegant as the original, and it is also unclear whether adding an independent source of randomness fed to ˆ Y would itself be considered unfair. Moreover, if ˆ Y ( U ) is assumed to be a deterministic function of U and X , as in F AIR L EARNING , then the two deﬁnitions are the same 6 . Informally, this stricter deﬁnition corresponds to a notion of “almost surely equality” as opposed to “equality in distribution.” Without assuming that ˆ Y is a deterministic function of U and X , even the stricter version does not protect us against measure zero events where the counterfactuals are different. The deﬁnition of counterfactual fairness concisely emphasizes that U can be a random variable, and clariﬁes which conditional distribution it follows. Hence, it is our preferred way of introducing the concept even though it does not explicit suggests whether ˆ Y ( U ) has random inputs besides",
    "s2 relation to demographic parity": "Consider the graph A → X → Y . In general, if ˆ Y is a function of X only, then ˆ Y need not obey demographic parity, i.e. P ( ˆ Y | A = a ) ̸ = P ( ˆ Y | A = a ′ ) , 6 Notice that ˆ Y ( U ) is itself a random variable if U is, but the source of randomness, U , is the same across all counterfactuals. 13 where, since ˆ Y is a function of X , the probabilities are obtained by marginalizing over P ( X | A = a ) and P ( X | A = a ′ ) , respectively. If we postulate a structural equation X = αA + e X , then given A and X we can deduce e X . If ˆ Y is a function of e X only and, by assumption, e X is marginally independent of A , then ˆ Y is marginally independent of A : this follows the interpretation given in the previous section, where we interpret e X as “known” despite being mathematically deduced from the observation ( A = a, X = x ) . Therefore, the assumptions imply that ˆ Y will satisfy demographic parity, and that can be falsiﬁed. By way of contrast, if e X is not uniquely identiﬁable from the structural equation and ( A, X ) , then the distribution of ˆ Y depends on the value of A as we marginalize e X , and demographic parity will not follow. This leads to the following: Lemma 2. If all background variables U ′ ⊆ U in the deﬁnition of ˆ Y are determined from A and X , and all observable variables in the deﬁnition of ˆ Y are independent of A given U ′ , then ˆ Y satisﬁes demographic parity. Thus, counterfactual fairness can be thought of as a counterfactual analog of demographic parity, as present in the Red Car example further discussed in the next section.",
    "s3 examples revisited": "In Section 3.1, we discussed two examples. We reintroduce them here brieﬂy, add a third example, and explain some consequences of their causal structure to the design of counterfactually fair predictors. Scenario 1: The Red Car Revisited. In that scenario, the structure A → X ← U → Y implies that ˆ Y should not use either X or A . On the other hand, it is acceptable to use U . It is interesting to realize, however, that since U is related to A and X , there will be some association between Y and { A, X } as discussed in Section S1. In particular, if the structural equation for X is linear, then U is a linear function of A and X , and as such ˆ Y will also be a function of both A and X . This is not a problem, as it is still the case that the model implies that this is merely a functional dependence that disappears by conditioning on a postulated latent attribute U . Surprisingly, we must make ˆ Y a indirect function of A if we want a counterfactually fair predictor, as shown in the following Lemma. Lemma 3. Consider a linear model with the structure in Figure 1(a). Fitting a linear predictor to X only is not counterfactually fair, while the same algorithm will produce a fair predictor using both A and X . Proof. As in the deﬁnition, we will consider the population case, where the joint distribution is known. Consider the case where the equations described by the model in Figure 1(a) are deterministic and linear: X = αA + βU, Y = γU. Denote the variance of U as v U , the variance of A as v A , and assume all coefﬁcients are non-zero. The predictor ˆ Y ( X ) deﬁned by least-squares regression of Y on only X is given by ˆ Y ( X ) ≡ λX , where λ = Cov ( X, Y ) /V ar ( X )= βγv U / ( α 2 v A + β 2 v U ) ̸ = 0 . This predictor follows the concept of fairness through unawareness. We can test whether a predictor ˆ Y is counterfactually fair by using the procedure described in Section 2.2: (i) Compute U given observations of X, Y, A ; (ii) Substitute the equations involving A with an interventional value a ′ ; (iii) Compute the variables X, Y with the interventional value a ′ . It is clear here that ˆ Y a ( U )= λ ( αa + βU ) ̸ = ˆ Y a ′ ( U ) . This predictor is not counterfactually fair. Thus, in this case fairness through unawareness actually perpetuates unfairness. Consider instead doing least-squares regression of Y on X and A . Note that ˆ Y ( X, A ) ≡ λ X X + λ A A where λ X , λ A can be derived as follows: 14 \u0012 λ X λ A \u0013 = \u0012 V ar ( X ) Cov ( A, X ) Cov ( X, A ) V ar ( A ) \u0013 − 1 \u0012 Cov ( X, Y ) Cov ( A, Y ) \u0013 = 1 β 2 v U v A \u0012 v A − αv A − αv A α 2 v A + β 2 v U \u0013 \u0012 βγv U 0 \u0013 = \u0012 γ β − αγ β \u0013 (5) Now imagine we have observed A = a . This implies that X = αa + βU and our predictor is ˆ Y ( X, a ) = γ β ( αa + βU ) + − αγ β a = γU . Thus, if we substitute a with a counterfactual a ′ (the action step described in Section 2.2) the predictor ˆ Y ( X, A ) is unchanged. This is because our predictor is constructed in such a way that any change in X caused by a change in A is cancelled out by the λ A . Thus this predictor is counterfactually fair. Note that if Figure 1(a) is the true model for the real world then ˆ Y ( X, A ) will also satisfy demographic parity and equality of opportunity as ˆ Y will be unaffected by A . The above lemma holds in a more general case for the structure given in Figure 1(a): any non-constant estimator that depends only on X is not counterfactually fair as changing A always alters X . Scenario 2: High Crime Regions Revisited. The causal structure differs from the previous exam- ple by the extra edge X → Y . For illustration purposes, assume again that the model is linear. Unlike the previous case, a predictor ˆ Y trained using X and A is not counterfactually fair. The only change from Scenario 1 is that now Y depends on X as follows: Y = γU + θX . Now if we solve for λ X , λ A it can be shown that ˆ Y ( X, a )=( γ − α 2 θv A βv U ) U + αθa . As this predictor depends on the values of A that are not explained by U , then ˆ Y ( X, a ) ̸ = ˆ Y ( X, a ′ ) and thus ˆ Y ( X, A ) is not counterfactually fair. The following extra example complements the previous two examples. Scenario 3: University Success. A university wants to know if students will be successful post- graduation Y . They have information such as: grade point average (GPA), advanced placement (AP) exams results, and other academic features X . The university believes however, that an individual’s gender A may inﬂuence these features and their post-graduation success Y due to social discrimination. They also believe that independently, an individual’s latent talent U causes X and Y . The structure is similar to Figure 1(a), with the extra edge A → Y . We can again ask, is the predictor ˆ Y ( X, A ) counterfactually fair? In this case, the different between this and Scenario 1 is that Y is a function of U and A as follows: Y = γU + ηA . We can again solve for λ X , λ A and show that ˆ Y ( X, a )=( γ − αηv A βv U ) U + ηa . Again ˆ Y ( X, A ) is a function of A not explained by U , so it cannot be counterfactually fair.",
    "s4 analysis of individual pathways": "By way of an example, consider the following adaptation of the scenario concerning claims of gender bias in UC Berkeley’s admission process in the 1970s, commonly used a textbook example of Simpson’s Paradox. For each candidate student’s application, we have A as a binary indicator of whether the applicant is female, X as the choice of course to apply for, and Y a binary indicator of whether the application was successful or not. Let us postulate the causal graph that includes the edges A → X and X → Y only. We observe that A and Y are negatively associated, which in ﬁrst instance might suggest discrimination, as gender is commonly accepted here as a protected attribute for college admission. However, in the postulated model it turns out that A and Y are causally independent given X . More speciﬁcally, women tend to choose more competitive courses (those with higher rejection rate) than men when applying. Our judgment is that the higher rejection among female than male applicants is acceptable, if the mechanism A → X is interpreted as a choice which is under the control of the applicant. That is, free-will overrides whatever possible cultural background conditions that led to this discrepancy. In the framework of counterfactual fairness, we 15 could claim that A is not a protected attribute to begin with once we understand how the world works, and that including A in the predictor of success is irrelevant anyway once we include X in the classiﬁer. However, consider the situation where there is an edge A → Y , interpreted purely as the effect of discrimination after causally controlling for X . While it is now reasonable to postulate A to be a protected attribute, we can still judge that X is not an unfair outcome: there is no need to “deconvolve” A out of X to obtain an estimate of the other causes U X in the A → X mechanism. This suggests a simple modiﬁcation of the deﬁnition of counterfactual fairness. First, given the causal graph G assumed to encode the causal relationships in our system, deﬁne P G A as the set of all directed paths from A to Y in G which are postulated to correspond to all unfair chains of events where A causes Y . Let X P c G A ⊆ X be the subset of covariates not present in any path in P G A . Also, for any vector x , let x s represent the corresponding subvector indexed by S . The corresponding uppercase version X S is used for random vectors. Deﬁnition 7 ((Path-dependent) counterfactual fairness) . Predictor ˆ Y is (path-dependent) counter- factually fair with respect to path set P G A if under any context X = x and A = a , P ( ˆ Y A ← a,X P c G A ← x P c G A ( U ) = y | X = x, A = a ) = P ( ˆ Y A ← a ′ ,X ̸P c G A ← x P c G A ( U ) = y | X = x, A = a ) , (6) for all y and for any value a ′ attainable by A . This notion is related to controlled direct effects [ 29 ], where we intervene on some paths from A to Y , but not others. Paths in P G A are considered here to be the “direct” paths, and we condition on X and A similarly to the deﬁnition of probability of sufﬁciency (3). This deﬁnition is the same as the original counterfactual fairness deﬁnition for the case where P c G A = ∅ . Its interpretation is analogous to the original, indicating that for any X 0 ∈ X P c G A we are allowed to propagate information from the factual assigment A = a , along with what we learned about the background causes U X 0 , in order to reconstruct X 0 . The contribution of A is considered acceptable in this case and does not need to be “deconvolved.” The implication is that any member of X ̸P c G A can be included in the deﬁnition of ˆ Y . In the example of college applications, we are allowed to use the choice of course X even though A is a confounder for X and Y . We are still not allowed to use A directly, bypassing the background variables. As discussed by [ 27 ], there are some counterfactual manipulations usable in a causal deﬁnition of fairness that can be performed by exploiting only independence constraints among the counterfactuals: that is, without requiring the explicit description of structural equations or other models for latent variables. A contrast between the two approaches is left for future work, although we stress that they are in some sense complementary: we are motivated mostly by problems such as the one in Figure 1(d), where many of the mediators themselves are considered to be unfairly affected by the protected attribute, and independence constraints among counterfactuals alone are less likely to be useful in identifying constraints for the ﬁtting of a fair predictor.",
    "s5 the multifaceted dynamics of fairness": "One particularly interesting question was raised by one of the reviewers: what is the effect of continuing discrimination after fair decisions are made? For instance, consider the case where banks enforce a fair allocation of loans for business owners regardless of, say, gender. This does not mean such businesses will thrive at a balanced rate if customers continue to avoid female owned business at a disproportionate rate for unfair reasons. Is there anything useful that can be said about this issue from a causal perspective? The work here proposed regards only what we can inﬂuence by changing how machine learning- aided decision making takes place at speciﬁc problems. It cannot change directly how society as a whole carry on with their biases. Ironically, it may sound unfair to banks to enforce the allocation of resources to businesses at a rate that does not correspond to the probability of their respective success, even if the owners of the corresponding businesses are not to be blamed by that. One way of conciliating the different perspectives is by modeling how a fair allocation of loans, even if it does not come without a cost, can nevertheless increase the proportion of successful female businesses compared to the current baseline. This change can by itself have an indirect effect on the culture and behavior of a society, leading to diminishing continuing discrimination by a feedback mechanism, as in afﬁrmative action. We believe that in the long run isolated acts of fairness are beneﬁcial even if we do not have direct control on all sources of unfairness in any speciﬁc problem. Causal modeling can help on creating arguments about the long run impact of individual contributions as e.g. a type of macroeconomic assessment. There are many challenges, and we should not pretend that precise answers can be obtained, but in theory we should aim at educated quantitative assessments validating how a systemic improvement in society can emerge from localized ways of addressing fairness.",
    "s6 case study: nyc stop-and-frisk data": "Since 2002, the New York Police Department (NYPD) has recorded information about every time a police ofﬁcer has stopped someone. The ofﬁcer records information such as if the person was searched or frisked, if a weapon was found, their appearance, whether an arrest was made or a summons issued, if force was used, etc. We consider the data collected on males stopped during 2014 which constitutes 38,609 records. We limit our analysis to looking at just males stopped as this accounts for more than 90% of the data. We ﬁt a model which postulates that police interactions is caused by race and a single latent factor labeled Criminality that is meant to index other aspects of the individual that have been used by the police and which are independent of race. We do not claim that this model has a solid theoretical basis, we use it below as an illustration on how to carry on an analysis of counterfactually fair decisions. We also describe a spatial analysis of the estimated latent factors. Model. We model this stop-and-frisk data using the graph in Figure 3. Speciﬁcally, we posit main causes for the observations: Arrest (if an individual was arrested), Force (some sort of force was used during the stop), Frisked , and Searched . The ﬁrst cause of these observations is some measure of an individual’s latent Criminality , which we do not observe. We believe that Criminality also directly affects Weapon (an individual was found to be carrying a weapon). For all of the features previously mentioned we believe there is an additional cause, an individual’s Race which we do observe. This factor is introduced as we believe that these observations may be biased based on an ofﬁcer’s perception of whether an individual is likely a criminal or not, affected by an individual’s Race . Thus note that, in this model, Criminality is counterfactually fair for the prediction of any characteristic of the individual for problems where Race is a protected attribute. Visualization on a map of New York City. Each of the stops can be mapped to longitude and latitude points for where the stop occurred 7 . This allows us to visualize the distribution of two distinct populations: the stops of White and Black Hispanic individuals, shown in Figure 4. We note that there are more White individuals stopped ( 4492 ) than Black Hispanic individuals ( 2414 ). However, if we look at the arrest distribution (visualized geographically in the second plot) the rate of arrest for White individuals is lower ( 12 . 1% ) than for Black Hispanic individuals ( 19 . 8% , the highest rate for any race in the dataset). Given our model we can ask: “If every individual had been White, not they will be arrested, according to the model. The left-most plot shows the distribution of White and Black Hispanic populations in the stop-and-frisk dataset. The second plot shows the true arrests for all of the stops. Given our model we can compute whether or not every individual in the dataset would be arrest had they been white . We show this counterfactual in the third plot. Similarly, we can compute this counterfactual if everyone had been Black Hispanic, as shown in the fourth plot. would they have been arrested?”. The answer to this is in the third plot. We see that the overall number of arrests decreases (from 5659 to 3722 ). What if every individual had been Black Hispanic? The fourth plot shows an increase in the number of arrests had individuals been Black Hispanic, according to the model (from 5659 to 6439 ). The yellow and purple circles show two regions where the difference in counterfactual arrest rates is particularly striking. Thus, the model indicates that, even when everything else in the model is held constant, race has a differential affect on arrest rate under the (strong) assumptions of the model."
  },
  "equations": [
    "P(\\hat{Y}|A=0)=P(\\hat{Y}|A=1)",
    "P(\\hat{Y}=1|A=0,Y=1)=P(\\hat{Y}=1|A=1,Y=1)",
    "P(\\hat{Y}_{A\\gets a}\\;(U)=y\\mid X=x,A=a)=P(\\hat{Y}_{A\\gets a^{\\prime }}(U)=y\\mid X=x,A=a),",
    "P(Y=1\\mid\\hat{Y}=1,A=1)=P(Y=1\\mid\\hat{Y}=1,A=0),",
    "P(Y=1\\mid\\hat{Y}=1,A=1)=P(Y=1\\mid\\hat{Y}=1,A=0)",
    "\\begin{array}[]{ll}\\text{GPA}\\sim\\mathcal{N}(b_{G}+w_{G}^{K}K+w_{G}^{R}R+w_{G} ^{S}S,\\sigma_{G}),&\\text{FYA}\\sim\\mathcal{N}(w_{F}^{K}K+w_{F}^{R}R+w_{F}^{S}S, 1),\\\\ \\text{LSAT}\\sim\\text{Poisson}(\\exp(b_{L}+w_{L}^{K}K+w_{L}^{R}R+w_{L}^{S}S)),& \\text{K}\\sim\\mathcal{N}(0,1)\\end{array}",
    "\\text{GPA} =b_{G}+w_{G}^{R}R+w_{G}^{S}S+\\epsilon_{G},\\ \\ \\epsilon_{G}\\sim p( \\epsilon_{G})",
    "\\text{LSAT} =b_{L}+w_{L}^{R}R+w_{L}^{S}S+\\epsilon_{L},\\ \\ \\epsilon_{L}\\sim p( \\epsilon_{L})",
    "\\text{FYA} =b_{F}+w_{F}^{R}R+w_{F}^{S}S+\\epsilon_{F},\\ \\ \\epsilon_{F}\\sim p( \\epsilon_{F})",
    "\\mathbb{E}[\\hat{Y}\\mid do(A=a),X=x]-\\mathbb{E}[\\hat{Y}\\mid do(A=a^{\\prime}),X= x],",
    "X=A+U.",
    "\\mathbb{E}[\\hat{Y}_{A\\gets a}(U)\\mid A=a,X=x]-\\mathbb{E}[\\hat{Y}_{A \\gets a^{\\prime}}(U)\\mid A=a,X=x]=\\lambda U-\\lambda U=0.",
    "P(\\hat{Y}_{A\\gets a^{\\prime}}\\;(U)\\neq y\\mid X=x,A=a,\\hat{Y}=y).",
    "\\mathbb{E}[\\hat{Y}\\mid do(A=a),X=x]-\\mathbb{E}[\\hat{Y}\\mid do(A=a^{\\prime}),X= x],\\] (2)",
    "\\mathbb{E}[\\hat{Y}_{A\\gets a}(U)\\mid A=a,X=x]-\\mathbb{E}[\\hat{Y}_{A \\gets a^{\\prime}}(U)\\mid A=a,X=x]=\\lambda U-\\lambda U=0.\\]",
    "P(\\hat{Y}_{A\\gets a}(U)=\\hat{Y}_{A\\gets a^{\\prime}}(U)\\mid X=x,A=a) =1.",
    "P(\\hat{Y}\\mid A=a)\\neq P(\\hat{Y}\\mid A=a^{\\prime}),",
    "X=\\alpha A+\\beta U,\\quad Y=\\gamma U.",
    "\\begin{pmatrix}\\lambda_{X}\\\\ \\lambda_{A}\\end{pmatrix} =\\begin{pmatrix}Var(X)&Cov(A,X)\\\\ Cov(X,A)&Var(A)\\end{pmatrix}^{-1}\\begin{pmatrix}Cov(X,Y)\\\\ Cov(A,Y)\\end{pmatrix}",
    "=\\frac{1}{\\beta^{2}v_{U}v_{A}}\\begin{pmatrix}v_{A}&-\\alpha v_{A}\\\\ -\\alpha v_{A}&\\alpha^{2}v_{A}+\\beta^{2}v_{U}\\end{pmatrix}\\begin{pmatrix}\\beta \\gamma v_{U}\\\\ 0\\end{pmatrix}",
    "=\\begin{pmatrix}\\frac{\\gamma}{\\beta}\\\\ \\frac{-\\alpha\\gamma}{\\beta}\\end{pmatrix}",
    "P(\\hat{Y}_{A\\gets a,X_{\\mathcal{P}^{c}_{\\mathcal{G}_{A}}} \\gets x_{\\mathcal{P}^{c}_{\\mathcal{G}_{A}}}}(U)=y\\mid X=x,A=a)=",
    "P(\\hat{Y}_{A\\gets a^{\\prime},X_{\\mathcal{P}^{c}_{\\mathcal{G }_{A}}}\\gets x_{\\mathcal{P}^{c}_{\\mathcal{G}_{A}}}}(U)=y\\mid X=x,A=a),"
  ],
  "metadata": {
    "filename": "paper.pdf",
    "pages": 18,
    "title": "Counterfactual Fairness",
    "author": ""
  }
}